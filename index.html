<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>Equipment Survey</title>
<link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700&family=Source+Sans+3:wght@300;400;600&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #f0f2f5;
    --surface: #ffffff;
    --surface2: #e8ecf1;
    --border: #d0d6df;
    --accent: #e8500a;
    --accent-hover: #c44008;
    --navy: #1a2f4e;
    --navy-light: #2a4570;
    --blue: #2a6db5;
    --green: #1e7a4a;
    --red: #cc2222;
    --text: #1a2032;
    --muted: #6b7a93;
    --input-bg: #f7f9fc;
    --tag-cooler-bg: #dff5ec; --tag-cooler: #1a6b45;
    --tag-freezer-bg: #ddeaf8; --tag-freezer: #1a4a8f;
    --tag-hvac-bg: #fdeede; --tag-hvac: #b83d08;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
  body { font-family: 'Source Sans 3', sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; font-size: 15px; }

  /* HEADER */
  .app-header { background: var(--navy); border-bottom: 3px solid var(--accent); padding: 12px 16px; position: sticky; top: 0; z-index: 200; display: flex; align-items: center; justify-content: space-between; }
  .app-header h1 { font-family: 'Rajdhani', sans-serif; font-size: 20px; font-weight: 700; letter-spacing: 2px; text-transform: uppercase; color: #ffffff; }
  .header-meta { font-family: 'Rajdhani', sans-serif; font-size: 13px; color: rgba(255,255,255,0.6); letter-spacing: 1px; }

  /* SCREENS */
  .screen { display: none; }
  .screen.active { display: block; }
  .container { max-width: 700px; margin: 0 auto; padding: 18px 14px 100px; }

  /* SURVEY HEADER CARD */
  .survey-header-card { background: var(--surface); border: 1px solid var(--border); border-left: 4px solid var(--accent); border-radius: 8px; padding: 16px; margin-bottom: 14px; }
  .survey-header-card h2 { font-family: 'Rajdhani', sans-serif; font-size: 11px; font-weight: 700; letter-spacing: 2.5px; text-transform: uppercase; color: var(--navy); margin-bottom: 12px; }

  /* FIELD GRID */
  .field-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
  .field-grid.cols-1 { grid-template-columns: 1fr; }
  .field-grid.cols-3 { grid-template-columns: 1fr 1fr 1fr; }
  .field { display: flex; flex-direction: column; gap: 4px; }
  .field.span2 { grid-column: span 2; }

  label { font-size: 10px; font-weight: 600; letter-spacing: 1px; text-transform: uppercase; color: var(--muted); }

  input, select, textarea {
    background: var(--input-bg); border: 1px solid var(--border); border-radius: 6px; color: var(--text);
    font-family: 'Source Sans 3', sans-serif; font-size: 15px; padding: 10px 12px; width: 100%;
    transition: border-color 0.15s; -webkit-appearance: none; appearance: none;
  }
  select { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%236b7585' stroke-width='1.5' fill='none' stroke-linecap='round'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 12px center; padding-right: 32px; }
  input:focus, select:focus, textarea:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 3px rgba(232,80,10,0.12); }
  select option { background: #ffffff; color: #1a2032; }
  textarea { resize: vertical; min-height: 72px; line-height: 1.5; }

  /* SECTION CARD */
  .section-card { background: var(--surface); border: 1px solid var(--border); border-radius: 8px; padding: 16px; margin-bottom: 12px; }
  .section-title { font-family: 'Rajdhani', sans-serif; font-size: 11px; font-weight: 700; letter-spacing: 2.5px; text-transform: uppercase; color: var(--navy); margin-bottom: 14px; padding-bottom: 8px; border-bottom: 1px solid var(--border); }

  /* EQUIPMENT LIST */
  .eq-list { display: flex; flex-direction: column; gap: 10px; margin-bottom: 16px; }
  .eq-card { background: var(--surface); border: 1px solid var(--border); border-radius: 8px; padding: 14px 16px; display: flex; align-items: center; gap: 12px; transition: border-color 0.15s, box-shadow 0.15s; } .eq-card:hover { border-color: var(--navy); box-shadow: 0 2px 8px rgba(26,47,78,0.1); }
  .eq-type-badge { flex-shrink: 0; width: 46px; height: 46px; border-radius: 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; font-family: 'Rajdhani', sans-serif; font-size: 9px; font-weight: 700; letter-spacing: 1px; text-transform: uppercase; }
  .badge-cooler { background: var(--tag-cooler-bg); color: var(--tag-cooler); border: 1px solid var(--tag-cooler); }
  .badge-freezer { background: var(--tag-freezer-bg); color: var(--tag-freezer); border: 1px solid var(--tag-freezer); }
  .badge-hvac { background: var(--tag-hvac-bg); color: var(--tag-hvac); border: 1px solid var(--tag-hvac); }
  .eq-card-info { flex: 1; min-width: 0; }
  .eq-card-name { font-weight: 600; font-size: 15px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .eq-card-sub { font-size: 12px; color: var(--muted); margin-top: 2px; }
  .eq-card-actions { display: flex; gap: 6px; flex-shrink: 0; }
  .btn-icon { background: var(--surface2); border: 1px solid var(--border); border-radius: 6px; color: var(--muted); width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 15px; transition: all 0.15s; }
  .btn-icon:hover { border-color: var(--navy); color: var(--navy); }
  .btn-icon.danger:hover { border-color: var(--red); color: var(--red); }

  /* EMPTY STATE */
  .empty-state { text-align: center; padding: 48px 20px; color: var(--muted); background: var(--surface); border: 1px dashed var(--border); border-radius: 8px; }
  .empty-state .icon { font-size: 36px; margin-bottom: 10px; }
  .empty-state p { font-size: 14px; line-height: 1.6; }

  /* BUTTONS */
  .btn { display: block; width: 100%; padding: 13px 20px; border-radius: 8px; font-family: 'Rajdhani', sans-serif; font-size: 14px; font-weight: 700; letter-spacing: 2px; text-transform: uppercase; cursor: pointer; text-align: center; transition: all 0.15s; border: none; }
  .btn + .btn { margin-top: 8px; }
  .btn-primary { background: var(--accent); color: #111; }
  .btn-primary:hover { background: #ffc233; }
  .btn-ghost { background: transparent; border: 1px solid var(--border); color: var(--text); }
  .btn-ghost:hover { border-color: var(--navy); color: var(--navy); }
  .btn-outline { background: transparent; border: 1px solid var(--accent); color: var(--accent); }
  .btn-outline:hover { background: var(--accent); color: #111; }

  /* PHOTOS */
  .photo-label-row { display: flex; gap: 8px; margin-bottom: 8px; align-items: center; }
  .photo-label-row input { flex: 1; padding: 8px 10px; font-size: 13px; }
  .photo-add-trigger { flex-shrink: 0; background: var(--surface2); border: 1px solid var(--border); border-radius: 6px; color: var(--muted); padding: 0 14px; height: 40px; display: flex; align-items: center; gap: 6px; cursor: pointer; font-size: 13px; font-weight: 600; white-space: nowrap; transition: all 0.15s; }
  .photo-add-trigger:hover { border-color: var(--accent); color: var(--accent); background: #fff5f0; }
  #photo-input { display: none; }
  .photo-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
  .photo-thumb { position: relative; aspect-ratio: 1; border-radius: 6px; overflow: hidden; border: 1px solid var(--border); background: var(--input-bg); }
  .photo-thumb img { width: 100%; height: 100%; object-fit: cover; display: block; }
  .photo-thumb .photo-label-overlay { position: absolute; bottom: 0; left: 0; right: 0; background: rgba(0,0,0,0.72); font-size: 10px; padding: 3px 6px; color: #fff; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .photo-thumb .photo-delete { position: absolute; top: 4px; right: 4px; background: rgba(0,0,0,0.65); border: none; border-radius: 4px; color: #fff; width: 22px; height: 22px; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 12px; }
  .photo-add-slot { aspect-ratio: 1; border-radius: 6px; border: 1px dashed var(--border); background: var(--input-bg); display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; color: var(--muted); font-size: 11px; gap: 4px; transition: border-color 0.15s; }
  .photo-add-slot:hover { border-color: var(--accent); color: var(--accent); background: #fff5f0; }
  .photo-add-slot .plus { font-size: 22px; }
  .photo-count-msg { font-size: 12px; color: var(--muted); margin-top: 6px; }

  /* SUMMARY */
  .summary-job-header { background: var(--navy); border: 1px solid var(--navy); border-left: 4px solid var(--accent); border-radius: 8px; padding: 18px 20px; margin-bottom: 20px; }
  .summary-job-header h2 { font-family: 'Rajdhani', sans-serif; font-size: 22px; font-weight: 700; color: #ffffff; letter-spacing: 1px; margin-bottom: 12px; }
  .summary-meta-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px 20px; }
  .smeta-label { font-size: 10px; text-transform: uppercase; letter-spacing: 1px; color: rgba(255,255,255,0.65); font-weight: 600; }
  .smeta-value { font-size: 15px; color: #ffffff; font-weight: 600; }
  .summary-eq-card { background: var(--surface); border: 1px solid var(--border); border-radius: 8px; padding: 16px 18px; margin-bottom: 14px; }
  .summary-eq-header { display: flex; align-items: center; gap: 12px; margin-bottom: 14px; padding-bottom: 10px; border-bottom: 1px solid var(--border); }
  .summary-eq-header h3 { font-family: 'Rajdhani', sans-serif; font-size: 18px; font-weight: 700; letter-spacing: 1px; }
  .summary-data-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px 20px; }
  .sfield-label { font-size: 10px; text-transform: uppercase; letter-spacing: 1px; color: var(--muted); font-weight: 600; }
  .sfield-value { font-size: 14px; color: var(--text); }
  .sfield-value.empty { color: var(--border); font-style: italic; font-size: 12px; }
  .section-divider { font-family: 'Rajdhani', sans-serif; font-size: 11px; font-weight: 700; letter-spacing: 2px; text-transform: uppercase; color: var(--navy); margin: 12px 0 8px; padding-top: 8px; border-top: 1px solid var(--border); }
  .summary-notes { margin-top: 12px; padding-top: 10px; border-top: 1px solid var(--border); }
  .summary-notes p { font-size: 14px; line-height: 1.5; }
  .photos-summary-section { background: var(--surface); border: 1px solid var(--border); border-radius: 8px; padding: 16px 18px; margin-bottom: 14px; }
  .photos-summary-section h3 { font-family: 'Rajdhani', sans-serif; font-size: 11px; font-weight: 700; letter-spacing: 2px; text-transform: uppercase; color: var(--navy); margin-bottom: 14px; }
  .photo-group { margin-bottom: 16px; }
  .photo-group-title { font-size: 12px; font-weight: 600; color: var(--muted); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; }
  .photo-summary-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
  .photo-summary-item img { width: 100%; aspect-ratio: 1; object-fit: cover; border-radius: 6px; border: 1px solid var(--border); display: block; }
  .photo-summary-item .ps-label { font-size: 10px; color: var(--muted); margin-top: 3px; text-align: center; }

  /* PRINT */
  @media print {
    * { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    body { background: #fff; color: #1a2032; }
    .no-print { display: none !important; }
    .screen { display: block !important; }
    #screen-list, #screen-form { display: none !important; }
    #screen-summary { display: block !important; }
    .app-header { background: #1a2f4e; border-bottom: 3px solid #e8500a; position: relative; }
    .app-header h1 { color: #ffffff; }
    .header-meta { display: none; }
    .summary-job-header { background: #1a2f4e !important; border-color: #1a2f4e; border-left-color: #e8500a; }
    .summary-job-header h2 { color: #ffffff; }
    .smeta-label { color: rgba(255,255,255,0.65); }
    .smeta-value { color: #ffffff; }
    .sfield-label, .photo-group-title { color: #555; }
    .sfield-value { color: #1a2032; }
    .summary-eq-card, .photos-summary-section { background: #fff; border-color: #ccc; break-inside: avoid; }
    .summary-eq-header { border-bottom-color: #eee; }
    .section-divider { color: #1a2f4e; border-top-color: #ddd; }
    .summary-notes { border-top-color: #eee; }
    .sfield-value.empty { color: #ccc; }
    .badge-cooler { background: #dff5ec; color: #1a6b45; border-color: #1a6b45; }
    .badge-freezer { background: #ddeaf8; color: #1a4a8f; border-color: #1a4a8f; }
    .badge-hvac { background: #fdeede; color: #b83d08; border-color: #b83d08; }
    .photo-summary-grid { grid-template-columns: repeat(4, 1fr); }
  }
</style>
</head>
<body>

<div class="app-header">
  <h1>‚öô Equip Survey</h1>
  <span class="header-meta" id="hdr-meta">0 units</span>
</div>

<!-- ‚ïê‚ïê LIST SCREEN ‚ïê‚ïê -->
<div id="screen-list" class="screen active">
  <div class="container">

    <div class="survey-header-card">
      <h2>Survey Info</h2>
      <div class="field-grid">
        <div class="field">
          <label>Job Name</label>
          <input type="text" id="h-job" placeholder="e.g. Smith's Grocery">
        </div>
        <div class="field">
          <label>Date</label>
          <input type="date" id="h-date">
        </div>
        <div class="field">
          <label>Service Company</label>
          <input type="text" id="h-company" placeholder="Company name">
        </div>
        <div class="field">
          <label>Audited By</label>
          <input type="text" id="h-auditor" placeholder="Full name">
        </div>
      </div>
    </div>

    <div class="survey-header-card">
      <h2>General Comments</h2>
      <div class="field">
        <textarea id="h-notes" placeholder="General site observations, conditions, access notes..." rows="3"></textarea>
      </div>
    </div>

    <div id="eq-list" class="eq-list">
      <div class="empty-state">
        <div class="icon">üî©</div>
        <p>No equipment logged yet.<br>Tap <strong>Add Equipment</strong> to begin.</p>
      </div>
    </div>

    <button class="btn btn-primary" onclick="showForm(-1)">+ Add Equipment</button>
    <button class="btn btn-outline" onclick="showSummary()">View / Print Summary</button>
  </div>
</div>

<!-- ‚ïê‚ïê FORM SCREEN ‚ïê‚ïê -->
<div id="screen-form" class="screen">
  <div class="container">

    <div class="section-card">
      <div class="section-title">Unit Info</div>
      <div class="field-grid cols-1">
        <div class="field">
          <label>Equipment Type *</label>
          <select id="f-type">
            <option value="">-- Select Type --</option>
            <option value="Cooler">Cooler</option>
            <option value="Freezer">Freezer</option>
            <option value="HVAC">HVAC</option>
          </select>
        </div>
        <div class="field">
          <label>Unit Name / Tag *</label>
          <input type="text" id="f-name" placeholder="e.g. Walk-in Cooler #1">
        </div>
      </div>
      <div class="field-grid" style="margin-top:10px;">
        <div class="field">
          <label>Location</label>
          <select id="f-location">
            <option value="">-- Select --</option>
            <option value="Pad Mount">Pad Mount</option>
            <option value="Roof">Roof</option>
          </select>
        </div>
        <div class="field">
          <label>Zone / Area</label>
          <input type="text" id="f-zone" placeholder="e.g. Produce Room">
        </div>

      </div>
    </div>

    <div class="section-card">
      <div class="section-title">Compressor</div>
      <div class="field-grid">
        <div class="field"><label>Brand</label><input type="text" id="f-comp-brand" placeholder="e.g. Copeland"></div>
        <div class="field"><label>Model</label><input type="text" id="f-comp-model" placeholder="e.g. ZB45KCE"></div>
        <div class="field"><label>HP</label><input type="text" id="f-comp-hp" placeholder="e.g. 3.5"></div>
        <div class="field"><label>Type</label><select id="f-comp-type"><option value="">-- Select --</option><option>Recip</option><option>Scroll</option><option>Screw</option></select></div>
        <div class="field"><label>Refrigerant</label><select id="f-refrigerant"><option value="">-- Select --</option><option>Freon</option><option>Ammonia</option></select></div>
        <div class="field"><label>Refrigerant #</label><input type="text" id="f-refrigerant-num" placeholder="e.g. R-404A"></div>
      </div>
    </div>

    <div class="section-card">
      <div class="section-title">Electrical</div>
      <div class="field-grid">
        <div class="field">
          <label>Voltage</label>
          <select id="f-voltage">
            <option value="">--</option>
            <option>115V</option><option>208V</option><option>230V</option><option>460V</option><option>480V</option>
          </select>
        </div>


      </div>
      <div class="field-grid" style="margin-top:10px;">
        <div class="field"><label>RLA (Amps)</label><input type="text" inputmode="decimal" id="f-rla" placeholder="e.g. 18.5"></div>
        <div class="field"><label>LRA (Amps)</label><input type="text" inputmode="decimal" id="f-lra" placeholder="e.g. 112"></div>
      </div>
    </div>

    <div class="section-card">
      <div class="section-title">Field Notes</div>
      <div class="field">
        <textarea id="f-notes" placeholder="Observations, condition, installation notes..."></textarea>
      </div>
    </div>

    <div class="section-card">
      <div class="section-title">Photos <span style="font-weight:400;color:var(--muted);font-size:10px;">(up to 5)</span></div>
      <div class="photo-label-row">
        <input type="text" id="photo-label-input" placeholder="Label (e.g. Nameplate, Overview, Wiring...)">
        <button class="photo-add-trigger" onclick="triggerPhoto()">üì∑ Add</button>
      </div>
      <input type="file" id="photo-input" accept="image/*" capture="environment" multiple onchange="handlePhotos(event)">
      <div class="photo-grid" id="photo-grid"></div>
      <div class="photo-count-msg" id="photo-count-msg"></div>
    </div>
    <div class="section-card">
      <div class="section-title">Photo of Possible Install Location</div>
      <div class="photo-label-row">
        <input type="text" id="install-photo-label-input" placeholder="Label (e.g. North wall, Rooftop corner...)">
        <button class="photo-add-trigger" onclick="triggerInstallPhoto()">üì∑ Add</button>
      </div>
      <input type="file" id="install-photo-input" accept="image/*" capture="environment" onchange="handleInstallPhoto(event)">
      <div class="photo-grid" id="install-photo-grid"></div>
      <div class="photo-count-msg" id="install-photo-count-msg"></div>
    </div>


    <button class="btn btn-primary" onclick="saveEquipment()">Save Equipment</button>
    <button class="btn btn-ghost" onclick="showList()">Cancel</button>
  </div>
</div>

<!-- ‚ïê‚ïê SUMMARY SCREEN ‚ïê‚ïê -->
<div id="screen-summary" class="screen">
  <div class="container">
    <div id="summary-content"></div>
    <button class="btn btn-primary no-print" onclick="window.print()">üñ® Print / Save as PDF</button>
    <button class="btn btn-ghost no-print" onclick="showList()">‚Üê Back</button>
  </div>
</div>

<script>
let equipment = [];
let surveyHeader = { job:'', date:'', company:'', auditor:'', notes:'' };
let formPhotos = [];

let editIndex = -1;

// INIT
(function() {
  const saved = localStorage.getItem('eq_survey_v3');
  if (saved) {
    try { const d = JSON.parse(saved); equipment = d.equipment || []; surveyHeader = d.header || surveyHeader; } catch(e) {}
  }
  loadHeader();
  renderList();
  if (!surveyHeader.date) document.getElementById('h-date').valueAsDate = new Date();
})();

function persist() {
  saveHeader();
  localStorage.setItem('eq_survey_v3', JSON.stringify({ equipment, header: surveyHeader }));
  document.getElementById('hdr-meta').textContent = equipment.length + ' unit' + (equipment.length !== 1 ? 's' : '');
}

function loadHeader() {
  document.getElementById('h-job').value = surveyHeader.job || '';
  document.getElementById('h-date').value = surveyHeader.date || '';
  document.getElementById('h-company').value = surveyHeader.company || '';
  document.getElementById('h-auditor').value = surveyHeader.auditor || '';
  document.getElementById('h-notes').value = surveyHeader.notes || '';
  document.getElementById('hdr-meta').textContent = equipment.length + ' unit' + (equipment.length !== 1 ? 's' : '');
}

function saveHeader() {
  surveyHeader.job = document.getElementById('h-job').value.trim();
  surveyHeader.date = document.getElementById('h-date').value;
  surveyHeader.company = document.getElementById('h-company').value.trim();
  surveyHeader.auditor = document.getElementById('h-auditor').value.trim();
  surveyHeader.notes = document.getElementById('h-notes').value.trim();
}

function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  window.scrollTo(0,0);
}

function showList() { loadHeader(); renderList(); showScreen('screen-list'); }
function showSummary() { saveHeader(); persist(); renderSummary(); showScreen('screen-summary'); }

function badgeClass(t) { return t==='Cooler'?'badge-cooler':t==='Freezer'?'badge-freezer':'badge-hvac'; }
function typeIcon(t) { return t==='Cooler'?'‚ùÑ':t==='Freezer'?'üßä':'üí®'; }

function renderList() {
  const c = document.getElementById('eq-list');
  if (!equipment.length) {
    c.innerHTML = `<div class="empty-state"><div class="icon">üî©</div><p>No equipment logged yet.<br>Tap <strong>Add Equipment</strong> to begin.</p></div>`;
    return;
  }
  c.innerHTML = equipment.map((eq,i) => `
    <div class="eq-card">
      <div class="eq-type-badge ${badgeClass(eq.type)}">
        <span style="font-size:18px">${typeIcon(eq.type)}</span>
        <span>${eq.type||'?'}</span>
      </div>
      <div class="eq-card-info">
        <div class="eq-card-name">${h(eq.name||'Unnamed Unit')}</div>
        <div class="eq-card-sub">${[eq.location,eq.zone].filter(Boolean).map(h).join(' ¬∑ ')||'No location'} ${eq.photos&&eq.photos.length?'¬∑ üì∑ '+eq.photos.length:''}</div>
      </div>
      <div class="eq-card-actions">
        <button class="btn-icon" onclick="showForm(${i})">‚úèÔ∏è</button>
        <button class="btn-icon danger" onclick="delEq(${i})">üóë</button>
      </div>
    </div>`).join('');
}

function showForm(idx) {
  editIndex = idx;
  formPhotos = [];
  formInstallPhoto = null;
  const eq = idx>=0 ? equipment[idx] : {};
  document.getElementById('f-type').value = eq.type||'';
  document.getElementById('f-name').value = eq.name||'';
  document.getElementById('f-location').value = eq.location||'';
  document.getElementById('f-zone').value = eq.zone||'';
  document.getElementById('f-comp-brand').value = eq.compBrand||'';
  document.getElementById('f-comp-model').value = eq.compModel||'';
  document.getElementById('f-comp-hp').value = eq.compHp||'';
  document.getElementById('f-comp-type').value = eq.compType||'';
  document.getElementById('f-refrigerant').value = eq.refrigerant||'';
  document.getElementById('f-refrigerant-num').value = eq.refrigerantNum||'';
  document.getElementById('f-voltage').value = eq.voltage||'';
  document.getElementById('f-rla').value = eq.rla||'';
  document.getElementById('f-lra').value = eq.lra||'';
  document.getElementById('f-notes').value = eq.notes||'';
  document.getElementById('photo-label-input').value = '';
  document.getElementById('install-photo-label-input').value = '';
  formInstallPhoto = eq.installPhoto || null;
  renderInstallPhoto();
  formPhotos = eq.photos ? JSON.parse(JSON.stringify(eq.photos)) : [];
  renderPhotoGrid();
  showScreen('screen-form');
}

function saveEquipment() {
  const type = document.getElementById('f-type').value;
  const name = document.getElementById('f-name').value.trim();
  if (!type) { alert('Please select an equipment type.'); return; }
  if (!name) { alert('Please enter a unit name or tag.'); return; }
  const eq = {
    type, name,
    location: document.getElementById('f-location').value,
    zone: document.getElementById('f-zone').value.trim(),
    compBrand: document.getElementById('f-comp-brand').value.trim(),
    compModel: document.getElementById('f-comp-model').value.trim(),
    compHp: document.getElementById('f-comp-hp').value.trim(),
    compType: document.getElementById('f-comp-type').value,
    refrigerant: document.getElementById('f-refrigerant').value,
    refrigerantNum: document.getElementById('f-refrigerant-num').value.trim(),
    voltage: document.getElementById('f-voltage').value,
    rla: document.getElementById('f-rla').value.trim(),
    lra: document.getElementById('f-lra').value.trim(),
    notes: document.getElementById('f-notes').value.trim(),
    photos: formPhotos,
    installPhoto: formInstallPhoto
  };
  if (editIndex>=0) equipment[editIndex]=eq; else equipment.push(eq);
  persist(); showList();
}

function delEq(i) {
  if (!confirm('Delete this unit?')) return;
  equipment.splice(i,1); persist(); renderList();
}

// INSTALL PHOTO
function triggerInstallPhoto() {
function handleInstallPhoto(e) {
  const file = e.target.files[0];
  if (!file) return;
  const label = document.getElementById('install-photo-label-input').value.trim() || 'Install Location';
  const r = new FileReader();
  r.onload = ev => {
  };
  r.readAsDataURL(file);
  e.target.value = '';
}

function removeInstallPhoto() {
}

}

// PHOTOS
function triggerPhoto() {
  if (formPhotos.length>=5) { alert('Maximum 5 photos per unit.'); return; }
  document.getElementById('photo-input').click();
}

function handlePhotos(e) {
  const files = Array.from(e.target.files);
  const label = document.getElementById('photo-label-input').value.trim() || 'Photo';
  const slots = 5 - formPhotos.length;
  files.slice(0,slots).forEach((f,idx) => {
    const r = new FileReader();
    r.onload = ev => {
      formPhotos.push({ dataUrl: ev.target.result, label: files.length>1 ? label+' '+(idx+1) : label });
      renderPhotoGrid();
    };
    r.readAsDataURL(f);
  });
  e.target.value = '';
}

function removePhoto(i) { formPhotos.splice(i,1); renderPhotoGrid(); }

function handleInstallPhoto(e) {
  const file = e.target.files[0];
  if (!file) return;
  const r = new FileReader();
  r.onload = ev => {
    formInstallPhoto = ev.target.result;
    renderInstallPhoto();
  };
  r.readAsDataURL(file);
  e.target.value = '';
}

function renderInstallPhoto() {
  const preview = document.getElementById('install-photo-preview');
  if (!preview) return;
  if (formInstallPhoto) {
    preview.innerHTML = `
      <div class="photo-thumb" style="width:100%;aspect-ratio:16/9;margin-bottom:6px;">
        <img src="${formInstallPhoto}" alt="Install Location" style="width:100%;height:100%;object-fit:cover;">
        <div class="photo-label-overlay">Install Location</div>
        <button class="photo-delete" onclick="formInstallPhoto=null;renderInstallPhoto();">‚úï</button>
      </div>`;
  } else {
    preview.innerHTML = '';
  }
}

function renderPhotoGrid() {
  const g = document.getElementById('photo-grid');
  let html = formPhotos.map((p,i) => `
    <div class="photo-thumb">
      <img src="${p.dataUrl}" alt="${h(p.label)}">
      <div class="photo-label-overlay">${h(p.label)}</div>
      <button class="photo-delete" onclick="removePhoto(${i})">‚úï</button>
    </div>`).join('');
  if (formPhotos.length<5) html += `<div class="photo-add-slot" onclick="triggerPhoto()"><span class="plus">+</span><span>Add Photo</span></div>`;
  g.innerHTML = html;
  document.getElementById('photo-count-msg').textContent = formPhotos.length ? formPhotos.length+'/5 photo'+(formPhotos.length!==1?'s':'') : '';
}

// SUMMARY
function fmtDate(d) {
  if (!d) return '';
  const p = d.split('-');
  return p.length===3 ? p[1]+'/'+p[2]+'/'+p[0] : d;
}
function val(v) { return v ? `<span class="sfield-value">${h(v)}</span>` : `<span class="sfield-value empty">‚Äî</span>`; }
function sf(label, value) { return `<div><div class="sfield-label">${label}</div>${val(value)}</div>`; }

function renderSummary() {
  const hd = surveyHeader;
  let html = `
    <div class="summary-job-header">
      <h2>${h(hd.job||'Equipment Survey')}</h2>
      <div class="summary-meta-grid">
        <div><div class="smeta-label">Date</div><div class="smeta-value">${h(fmtDate(hd.date)||'‚Äî')}</div></div>
        <div><div class="smeta-label">Service Company</div><div class="smeta-value">${h(hd.company||'‚Äî')}</div></div>
        <div><div class="smeta-label">Audited By</div><div class="smeta-value">${h(hd.auditor||'‚Äî')}</div></div>
        <div><div class="smeta-label">Units Surveyed</div><div class="smeta-value">${equipment.length}</div></div>
      </div>
      ${hd.notes ? `<div style="margin-top:12px;padding-top:10px;border-top:1px solid var(--border)"><div class="smeta-label" style="margin-bottom:4px">General Comments</div><div style="font-size:14px;line-height:1.5">${h(hd.notes)}</div></div>` : ''}
    </div>`;

  if (!equipment.length) {
    html += `<div class="empty-state"><div class="icon">üìã</div><p>No equipment has been added yet.</p></div>`;
  } else {
    equipment.forEach(eq => {
      html += `
        <div class="summary-eq-card">
          <div class="summary-eq-header">
            <div class="eq-type-badge ${badgeClass(eq.type)}" style="width:42px;height:42px;font-size:8px">
              <span style="font-size:17px">${typeIcon(eq.type)}</span>
              <span>${h(eq.type)}</span>
            </div>
            <div>
              <h3>${h(eq.name)}</h3>
              <div style="font-size:12px;color:var(--muted)">${[eq.location,eq.zone].filter(Boolean).map(h).join(' ¬∑ ')||''}</div>
            </div>
          </div>
          <div class="section-divider">Compressor</div>
          <div class="summary-data-grid">
            ${sf('Brand',eq.compBrand)}${sf('Model',eq.compModel)}${sf('HP',eq.compHp)}${sf('Type',eq.compType)}${sf('Refrigerant',eq.refrigerant)}${sf('Refrigerant #',eq.refrigerantNum)}
          </div>
          <div class="section-divider">Electrical</div>
          <div class="summary-data-grid">
            ${sf('Voltage',eq.voltage)}${sf('RLA',eq.rla?eq.rla+'A':'')}${sf('LRA',eq.lra?eq.lra+'A':'')}
          </div>
          ${eq.notes?`<div class="summary-notes"><div class="sfield-label" style="margin-bottom:4px">Field Notes</div><p>${h(eq.notes)}</p></div>`:''}
          ${eq.installPhoto?`<div class="summary-notes"><div class="sfield-label" style="margin-bottom:6px">Install Location Photo</div><img src="${eq.installPhoto}" alt="Install Location" style="width:100%;max-width:340px;border-radius:6px;border:1px solid var(--border);display:block;"></div>`:''}
        </div>`;
    });

    
  }

  document.getElementById('summary-content').innerHTML = html;
}

function h(s) {
  if (!s) return '';
  return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

// Auto-save header
['h-job','h-date','h-company','h-auditor','h-notes'].forEach(id => {
  const el = document.getElementById(id);
  el.addEventListener('change', () => persist());
  el.addEventListener('input', () => persist());
});
</script>
</body>
</html>
